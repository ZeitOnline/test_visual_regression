# Visual Regression Testing with BackstopJS

This branch features a working example for visual regression testing using BackstopJS.

## Prerequisites

#### 1. Install [BackstopJS](https://github.com/garris/BackstopJS)

- Using npm: `npm install -g backstopjs`

#### 2. Clone this repo and install dependencies

1. `git clone git@github.com:ZeitOnline/test_visual_regression.git`
2. `cd test_visual_regression`
3. `git checkout backstop-js`
3. `npm install`

Resulting in the following directory tree:

```
.
├── backstop_data
│   ├── bitmaps_reference
│   │   └── [...] —> Generated reference screenshots (how it should look like)
│   ├── bitmaps_test
│   │   └── [...] —> Generated screenshots after testing (how it actually looks like)
│   └── html_report
│       └── [...] —> The report generated by BackstopJS after testing
├── backstop_tests
│   └── [...] —> Backstop test files/configs go here
├── old_tests
│   └── [...] —> To be transfered to backstop configs
├── utils
│   └── [...] —> Utility scripts go here
├── README.md
├── backstop-demo.json —> Demo test config generated by backstop
├── package-lock.json
└── package.json
```
#### 3. Make sure your local servers are running (Friedbert, SSO, ...)


## Running tests

#### 1. If no reference screenshots are available

Generate a reference you want to test against later on. This will create screenshots of all pages/elements that are defined in the config that is passed in as an argument.

`backstop reference --config=<path/to/config.js>`

Example: `backstop reference --config='backstop_tests/test-zar.js'`

#### 2. Test against the reference

After making some changes to your code, you might want to test if the pages still look the same or if they have been affected by your changes. After running the following command, a HTML report is generated and opened in your default browser.

`backstop test --config=<path/to/config.js>`

Example: `backstop test --config='backstop_tests/test-zar.js'`

#### 3. Approve changes

If you are happy with the results after testing, you may promote the test screenshots to be the new reference screenshots.

`backstop approve --config=<path/to/config.js>`

Example: `backstop approve --config='backstop_tests/test-zar.js'`

## Creating tests

Test configs for BackstopJS can be setup using JSON files or JS modules, see [BackstopJS Docs](https://github.com/garris/BackstopJS).

## Further reading
- [BackstopJS ReadMe](https://github.com/garris/BackstopJS)
