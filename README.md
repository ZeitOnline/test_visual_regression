# Visual Regression Testing with [BackstopJS](https://github.com/garris/BackstopJS)

## General
The visual regression process contains three steps:
- ### reference
  - generate the ideal result (how it should look) in order to compare the test result to this one later on.
- ### test
  - generate the real result (how it actually looks) to compare this one to the reference.
- ### approve
  - when the test is fine and the references shall be updated, you may approve them.

## Prerequisites

#### 1. Clone this repo and install dependencies

1. `git clone git@github.com:ZeitOnline/test_visual_regression.git`
2. `cd test_visual_regression`
3. `npm i`

Resulting in the following directory tree:

```
.
├── backstop_data
│   └── html_report
│       └── [...] —> The report generated by BackstopJS after testing
├── backstop_tests
│   └── [...] —> Legacy Backstop test files
├── data
│   ├── references
│   │   └── [...] —> Generated reference screenshots (how it should look like)
│   ├── tests
│   └── [...] —> Generated screenshots after testing (how it actually looks like)
├── scenarios
│   └── [...] —> Backstop test scenarios
├── utils
│   └── [...] —> Utility scripts go here
├── README.md
├── backstop-demo.json —> Demo test config generated by backstop
├── package-lock.json
└── package.json
```

#### 2. Make sure your (needed) local servers are running (Friedbert, SSO, ...)

## Running tests


#### 1. If no reference screenshots are available

Generate a reference you want to test against later on. This will create screenshots of all pages/elements, optionally filtered by label. Pass a ``--filter=<scenarioLabelRegex>`` argument to just run scenarios matching your scenario label.

`npm run reference`

Example: `npm run reference -- --filter=zon::video`

For further examples take a look at the package.json.

#### 2. Test against the reference

After making some changes to your code, you might want to test if the pages still look the same or if they have been affected by your changes. After running the following command, a HTML report is generated and opened in your default browser.

`npm run test`

Example: `npm run test -- --filter=zmo::`

#### 3. Approve changes

If you are happy with the results after testing, you may promote the test screenshots to be the new reference screenshots.

`npm run approve`

Example: `npm run approve -- --filter=zon-teaser-podcast-lead`

## Creating tests

Test configs for BackstopJS can be setup using JSON files or JS modules, see [BackstopJS Docs](https://github.com/garris/BackstopJS).

## Further reading
- [BackstopJS ReadMe](https://github.com/garris/BackstopJS)
