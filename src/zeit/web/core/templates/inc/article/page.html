{% set contents_printed = False %}
{% for block in page %}
    {% set type = block | block_type %}
    {% if not (contents_printed or view.is_all_pages_view) and type in ['paragraph'] %}
        {% include [
            "{0}:templates/inc/article/table-of-contents.html".format(view.package),
            "zeit.web.core:templates/inc/article/table-of-contents.html"] %}
        {% set contents_printed = True %}
    {% endif %}
    {% include [
        "{0}:templates/inc/blocks/{1}.html".format(view.package, type),
        "zeit.web.core:templates/inc/blocks/{0}.html".format(type)] ignore missing %}
{% endfor %}
