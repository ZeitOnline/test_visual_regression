{# XXX: Please, only set variables in jinja where absolutely needed. #}
{% set wt_kennung = view.webtrekk.identifier %}

<amp-analytics type="webtrekk">
    <script type="application/json">
        {
            "transport": {
                "beacon": false,
                "xhrpost": false,
                "image": true
            },
            "vars": {
                "trackDomain": "zeit01.webtrekk.net",
                "trackId": "981949533494636",
                "contentId": "{{ wt_kennung + '|' + view.content_url.replace('http://', '') }}"
            },
            "requests": {
                "trackURL": "https://${trackDomain}/${trackId}/wt",
                "parameterPrefix": "?p={{ settings('webtrekk_version', 3).replace('.', '') }},${contentId},1,${screenWidth}x${screenHeight},${screenColorDepth},0,${timestamp},${documentReferrer},${availableScreenWidth}x${availableScreenHeight},0&tz=${timezone}&eid=${clientId(amp-wt3-eid)}&la=${browserLanguage}",
                "parameterSuffix": "&pu=${canonicalUrl}",
                "pageParameter": "&cp1=${pageParameter1}&cp2=${pageParameter2}&cp3=${pageParameter3}&cp4=${pageParameter4}&cp5=${pageParameter5}&cp6=${pageParameter6}&cp7=${pageParameter7}&cp8=${pageParameter8}&cp9=${pageParameter9}&cp10=${pageParameter10}&cp11=${pageParameter11}&cp12=${pageParameter12}&cp13=${pageParameter13}&cp14=${pageParameter14}&cp15=${pageParameter15}&cp25=${pageParameter25}&cp26=${pageParameter26}&cp27=${pageParameter27}",
                "pageCategories": "&cg1=${pageCategory1}&cg2=${pageCategory2}&cg3=${pageCategory3}&cg4=${pageCategory4}&cg5=${pageCategory5}&cg6=${pageCategory6}&cg7=${pageCategory7}&cg8=${pageCategory8}&cg9=${pageCategory9}&cg10=${pageCategory10}",
                "pageview": "${trackURL}${parameterPrefix}${pageParameter}${pageCategories}${parameterSuffix}",
                "actionParameter": "&ck1=${actionParameter1}&ck2=${actionParameter2}&ck3=${actionParameter3}&ck4=${actionParameter4}&ck5=${actionParameter5}&ck10=${actionParameter10}",
                "event": "${trackURL}${parameterPrefix}&ct=${actionName}${actionParameter}${parameterSuffix}"
            },
            "triggers": {
                "trackPageview": {
                    "on": "visible",
                    "request": "pageview",
                    "vars": {
                        {% for key in view.webtrekk.contentGroup -%}
                            "pageCategory{{ key | replace('cg', '') | int }}": "{{ view.webtrekk.contentGroup[key] }}",
                        {% endfor -%}
                        {% for key in view.webtrekk.customParameter -%}
                            "pageParameter{{ key | replace('cp', '') | int }}": "{{ view.webtrekk.customParameter[key] }}"
                            {%- if not loop.last %},{% endif %}

                        {% endfor -%}
                    }
                },
                "trackLogoClick": {
                    "on": "click",
                    "selector": "#publisher a",
                    "request": "event",
                    "vars": {
                        "actionName": "amp.topnav.1.1..logo|www.zeit.de/index"
                    }
                },
                "trackImprimtClick": {
                    "on": "click",
                    "selector": ".footer__navigation li:nth-child(1) a",
                    "request": "event",
                    "vars": {
                        "actionName": "amp.footernav.2.1..impressum|www.zeit.de/impressum/index"
                    }
                },
                "trackPrivacyClick": {
                    "on": "click",
                    "selector": ".footer__navigation li:nth-child(2) a",
                    "request": "event",
                    "vars": {
                        "actionName": "amp.footernav.2.2..datenschutz|www.zeit.de/help/datenschutz"
                    }
                },
                "trackTopClick": {
                    "on": "click",
                    "selector": ".footer__button",
                    "request": "event",
                    "vars": {
                        "actionName": "amp.footernav.4.1..pfeil"
                    }
                }
            }
        }
    </script>
</amp-analytics>
