<script type="text/javascript" src="http://scripts.zeit.de/static/js/webtrekk/webtrekk_v3.js"></script>
<script type="text/javascript">
    {# XXX: Please, only set variables in jinja where absolutely needed. #}

    {% set date = '' -%}
    {% set pagination = '' -%}
    {% set serie = view.serie | replace(' ', '') | lower %}

    {% if view.date_first_released -%}
        {% set date = view.date_first_released | format_date('short_num') -%}
    {% endif -%}

    {% if view.pagination -%}
        {% set pagination = view.pagination.current ~'/'~ view.pagination.total -%}
    {% endif -%}

    {% set wt_kennung_part = 'redaktion.' + view.ressort | lower + '.' + view.sub_ressort | lower + '.' + serie + '.' + view.type | lower + '.online' %}
    {% set wt_kennung = "%s|%s%s" | format(wt_kennung_part, request.host, request.path) %}

    var Z_WT_KENNUNG = "{{ wt_kennung }}";

    var webtrekk = {
        linkTrack : "standard",
        heatmap : "0",
        linkTrackAttribute: "id"
    };

    if ( typeof webtrekkV3 === "function" ) {
        var wt = new webtrekkV3(webtrekk);
        wt.cookie = "1";
        wt.contentGroup = {
            1: "redaktion", // Zuordnung/Bereich
            2: "{{ view.tracking_type | lower }}", // Kategorie/Pagetype
            3: "{{ view.ressort | lower }}", // Ressort
            4: "online", // Online/Sourcetype
            5: "{{ view.sub_ressort | lower }}", // Subressort
            6: "{{ serie }}", // Cluster
            7: "{{ request.path_info | substring_from('/') }}", // doc-path
            8: "{{ view.banner_channel | lower }}", // Banner-Channel
            9: "{{ date }}" // {{ view.date_first_released | default("not published yet") }}
        };

        {% if view.type == "article" -%}
        ivw_min_width = ivw_min_width || 767;
        wt.customParameter = {
            1: "{{ view.authors_list | lower | hide_none }}", // Autor
            2: "{{ view.banner_channel | lower }}", // IVW-Code
            3: "{{ pagination }}", // Seite
            4: "{{ view.ranked_tags_list | lower }}", // Schlagworte
            5: "{{ view.date_last_modified }}", // Last published
            6: "{{ view.text_length }}", // TextlÃ¤nge
            7: "{{ view.source | hide_none | lower }}", // Quelle
            8: "{{ view.product_id | hide_none | lower }}", // Product-Id
            9: "{{ view.banner_channel | lower }}", // Banner-Channel
            10: "{%- if view.context.advertising_enabled %}yes{% endif -%}", // Banner aktiv?
            11: "", // Fehler
            12: window.innerWidth >= ivw_min_width ? 'desktop.site' : 'mobile.site'
        };
        {% endif -%}

        wt.contentId = Z_WT_KENNUNG;
        wt.sendinfo();
    }
</script>
<noscript>
    <div>
        <img alt="" width="1" height="1" src="{{ "%s,%s,0,0,0,0,0,0,0,0&cg1=%s&cg2=%s&cg3=%s&cg4=%s&cg5=%s&cg6=%s&cg7=%s&cg8=%s&cg9=%s" |
            format(
                "http://zeit01.webtrekk.net/981949533494636/wt.pl?p=328",
                wt_kennung,
                "redaktion",
                view.tracking_type | lower,
                view.ressort | lower,
                "online",
                view.sub_ressort | lower,
                serie,
                request.path_info | substring_from('/'),
                view.banner_channel | lower,
                date
            )
        }}{% if view.type == 'article' -%}{{ "&cp1=%s&cp2=%s&cp3=%s&cp4=%s&cp5=%s&cp6=%s&cp7=%s&cp8=%s&cp9=%s&cp10=%s&cp11=%s&cp12=%s" | format(
            view.authors_list | lower | hide_none,
            view.banner_channel | lower,
            pagination,
            view.ranked_tags_list | lower,
            view.date_last_modified,
            view.text_length,
            view.source | hide_none | lower,
            view.product_id | hide_none | lower,
            view.banner_channel | lower,
            "",
            "",
            ""
        ) }}{% endif -%}" />
    </div>
</noscript>
