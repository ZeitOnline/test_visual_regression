{% include "zeit.web.core:templates/inc/tracking/webtrekk_script.html" %}
<script type="text/javascript">
    {# XXX: Please, only set variables in jinja where absolutely needed. #}

    {% set serie = view.serie | replace(' ', '') | lower %}

    {% if view.is_breaking or view.is_push_news -%}
        {% set push = 'wichtigenachrichten.push' if view.is_push_news else 'eilmeldung.push' %}
    {% else %}
        {% set push = '' -%}
    {% endif -%}

    {% if view.date_first_released -%}
        {% set date = view.date_first_released | format_date('short_num') -%}
    {% else %}
        {% set date = '' -%}
    {% endif -%}

    {% if view.pagination -%}
        {% set pagination = view.pagination.current ~'/'~ view.pagination.total -%}
    {% else %}
        {% set pagination = '1/1' -%}
    {% endif -%}

    {# https://sites.google.com/a/apps.zeit.de/verpixelungskonzept-zeit-online/webtrekk#TOC-Struktur-der-Content-IDs #}
    {% set wt_kennung = 'redaktion.' + view.ressort | lower + '.' + view.sub_ressort | lower + '.' + serie + '.' + view.type | lower + '.' + view.product_id | lower + '|' + view.content_url.replace('http://', '') %}

    {% set ivw_code = '%s%sbild-text' | format(view.ressort | lower + '/' if view.ressort, view.sub_ressort | lower + '/' if view.sub_ressort) %}

    var Z_WT_KENNUNG = "{{ wt_kennung }}";

    var webtrekk = {
        linkTrack : "standard",
        heatmap : "0",
        linkTrackAttribute: "data-wt-click"
    };

    if ( typeof webtrekkV3 === "function" ) {
        var wt = new webtrekkV3(webtrekk);
        wt.cookie = "1";
        wt.contentGroup = {
            1: "redaktion", // Zuordnung/Bereich
            2: "{{ view.tracking_type | lower }}", // Kategorie/Pagetype
            3: "{{ view.ressort | lower }}", // Ressort
            4: "{{ view.product_id | lower }}", // Online/Sourcetype
            5: "{{ view.sub_ressort | lower }}", // Subressort
            6: "{{ serie }}", // Cluster
            7: "{{ request.path_info | substring_from('/') }}", // doc-path
            8: "{{ view.banner_channel | lower }}", // Banner-Channel
            9: "{{ date }}" // {{ view.date_first_released | default("not published yet") }}
        };

        wt.customParameter = {
            1: "{{ view.authors_list | lower }}", // Autor
            2: "{{ ivw_code }}", // IVW-Code
            3: "{{ pagination }}", // Seite
            4: "{{ view.meta_keywords | join(';') | lower if view.ressort | lower != 'homepage'}}", // Schlagworte
            5: "{{ view.date_last_modified }}", // Last published
            6: "{{ view.text_length }}", // Textl√§nge
            7: "{{ view.news_source | lower }}", // Quelle
            8: "{{ view.product_id | lower }}", // Product-Id
            9: "{{ view.banner_channel | lower }}", // Banner-Channel
            10: "{{ 'yes' if view.context.advertising_enabled else 'no' }}", // Banner aktiv?
            11: "", // Fehler
            12: window.FBIA.getSiteParam("site"),
            13: window.FBIA.getTrackingBreakpointAlike(),
            14: "{{ 'alt' if 'zeitmz' in view.banner_channel | default('', True) else 'neu'  }}",
            15: "{{ push }}", // Eilmeldungen
            25: "instant article" // Plattform
        };

        wt.contentId = Z_WT_KENNUNG;
        wt.sendinfo();
    }
</script>
