{% import 'zeit.web.site:templates/macros/footer_macro.tpl' as foma %}
{% import 'zeit.web.site:templates/macros/layout_macro.tpl' as lama %}

<footer class="footer" data-ct-area="footernav">
    <a href="{{ request.route_url('home') }}index" class="footer-brand" title="Nachrichten auf ZEIT ONLINE" data-ct-row="logo" data-ct-label="logo">
    {{ lama.use_svg_icon('logo-zon-black', 'footer-brand__logo', view.package) }}
    </a>

    {%- include "zeit.web.core:templates/inc/breadcrumbs.html" -%}

    <div itemscope itemtype="http://schema.org/SiteNavigationElement">
        <div class="footer-publisher" data-ct-row="top">
            {{ foma.footer_publisher(view) }}
        </div>
        <div class="footer-links" data-ct-row="bottom">
            {{ foma.footer_links(view) }}
            {% if view is not framebuilder %}
                {% include "zeit.web.core:templates/inc/inline_js/image-copyright-template.html" %}
            {% endif %}
            <div class="footer-links__button" data-ct-column="3">
                <a href="{{ view.canonical_url if not (view.is_wrapped or view is framebuilder) else '#top' }}" class="footer-links__linkbutton js-scroll" title="Zurück nach oben">Nach oben</a>
            </div>
        </div>
    </div>

    {% if toggles('optimize_ab_testing') -%}
        <script type="text/javascript">
            (function () {
                    if (typeof window.Zeit !== 'object') {
                        return;
                    }

                    window.Zeit.getOptimizeString = function () {
                        if (typeof window.gaData !== 'object') {
                            return "undefined";
                        }
                        /**
                        * ENTER DATA HERE
                        * property: Enter the Google Analytics PropertyID in Google Optimize
                        **/
                        var property = "UA-18122964-8";

                        /**
                        * format a given string to usage with webtrekk parameters naming style
                        * @param  str String
                        * @return String
                        *
                        * @notice by first changing case, we have don't have to search for upper case letters
                        **/
                        function formatStringForWebtrekk(str) {
                            var regex = /[Ã¶Ã¤Ã¼Ã–Ã„ÃœÃŸ\s\;\#]/g,
                                translate = { 'Ã¤': 'ae', 'Ã¶': 'oe', 'Ã¼': 'ue', 'ÃŸ': 'ss', ' ': '_', ';': '_', '#': '_' };
                            return (str.toLowerCase().replace(regex, function (match) {
                                return translate[match];
                            }).replace(/[\_]{2,}/g, '_'));
                        }

                        /**
                        * find the active google optimize experiment and log to webtrekk
                        **/
                        // variables always first
                        var experiments, expVarName, out = "", data = window.gaData;
                        // check for optimizely object moved to top level
                        if (typeof data[property] !== 'undefined' && data[property].experiments !== 'undefined') {
                            experiments = data[property].experiments;
                            for (var key in experiments) {
                                if (!experiments.hasOwnProperty(key)) continue;
                                // one stop function incl. lowercase and repeating underscore prevention
                                if (experiments[key] == "0") {
                                    expVarName = "original";
                                } else {
                                    expVarName = "variation_" + experiments[key];
                                }
                                out += formatStringForWebtrekk(key) + "." + expVarName + ";";
                            }
                        } else {
                            return "undefined";
                        }

                        return out.replace(/\;+$/g, '');
                    };
                })();
        </script>
    {% endif -%}
</footer>
