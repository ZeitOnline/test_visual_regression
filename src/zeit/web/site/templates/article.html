{% extends "zeit.web.site:templates/content.html" %}

{% macro render_page(page) %}
    {% set contents_printed = False %}
    {% for item in page %}
        {% set type = item | block_type %}
        {# XXX Urghs this is nasty #}
        {% if type in ['place', 'contentadblock', 'cardstack', 'liveblog'] %}
            {{ blocks[type](item, view) }}
        {% else %}
            {% if not (contents_printed or view.is_all_pages_view) and type in ['paragraph'] %}
                {% include "zeit.web.site:templates/inc/article/table-of-contents.tpl" %}
                {% set contents_printed = True %}
            {% endif %}
            {{ (blocks[type] or blocks["no_block"])(item) }}
        {% endif %}
    {% endfor %}
{% endmacro %}

{% block content_ad_script -%}
{% if view.context.advertising_enabled %}
<script type="text/javascript">
    (function() {
        var s = document.createElement('script');
        s.type = 'text/javascript';
        s.async = true;
        s.src = document.location.protocol + '//cdn.iqcontentplatform.de/iq.js';
        var sc = document.getElementsByTagName('script')[0]; sc.parentNode.insertBefore(s, sc);
    })();
</script>
{% endif %}
{%- endblock %}

{% block article_pages %}
    <div class="article-lineage">
        {% set predecessor, successor = view.lineage %}
        <a href="{{ predecessor.uniqueId | create_url }}" class="article-predecessor">
            {{ predecessor.title }}
        </a>
        <a href="{{ successor.uniqueId | create_url }}" class="article-successor">
            {{ successor.title }}
        </a>
    </div>
    <section class="article-page" data-page-number="{{ view.current_page.number + 1 }}">
        {{ render_page(view.current_page) }}
    </section>
{% endblock article_pages %}

{% block article_main_image %}
    {% if view.page_nr == 1 %}
        {{ blocks['image'](view.main_image_block)}}
    {% endif %}
{% endblock article_main_image %}

{% block article_pagination %}
    {% include "zeit.web.site:templates/inc/article/pagination.tpl" %}
{% endblock article_pagination %}

{% block print %}
    {% include "zeit.web.site:templates/inc/article/print.tpl" %}
{% endblock %}

